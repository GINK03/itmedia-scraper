　インターネットイニシアティブ（IIJ）が7月26日、IIJmioの中の人に会えるトークイベント「IIJmio meeting 8」を開催した。その中で、MVNO SIMを利用したSIMロックフリーiPhone／iPadで、新しいAPN構成プロファイルを利用すると、LTE接続が改善されることや、KDDIのLTEネットワークを使うMVNO SIMを挿したiPhone／iPadでも通信できるとした件について、詳細な検証結果が紹介された。 　「続、MVNOとSIMフリー端末の問題について（iOS編）」と題し、MVNO SIMを挿したSIMフリーiPhone／iPadがLTEになかなか接続しない事象について、IIJのエンジニア大内宗徳氏が調査結果を説明した。 　日本国内で携帯電話を利用するには、端末が「技適」を受けている必要があるが、さまざまなトラブルを回避するため、キャリアの接続テストを受けることも推奨されている。キャリアから販売される端末はこの接続テストを実施しているが、それなりに費用がかかるため、安価なSIMロックフリー端末の中には実施していないものもあり、接続に問題が起こることもあるという。 　SIMロックフリー版iPhoneの場合、キャリア版と異なるのはSIMロックの有無のみなので、接続に問題はないはずなのだが、キャリアSIMとMVNO SIMでは異なる挙動があり、LTEをつかみにくいという現象も実際に起こっている。この現象の原因を探ったのが、今回の検証内容だ。 　しかし、「基地局などの設備と端末がやり取りする制御情報を確認することは難しい」と大内氏は指摘する。端末がネットワークに接続する際のやり取りのほとんどがMNO（この場合はNTTドコモ）の設備内で起こっており、MVNOの設備に関わる部分はごくわずか。このわずかな情報で問題を調査するのはほぼ不可能だという。 　そこで、MVNOでも検証可能な、端末と基地局の無線区間の制御信号を調査した。調査方法はいくつかあるが、端末内で通信機能を担っているベースバンドチップの制御信号を確認する方法を採用。スマホで多く使われているQualcomm製ベースバンドチップの場合、制御情報を解析できるツールが各社から提供されているが、今回はMeritech社の技術協力を受けて解析した。 　今回は4つの現象について調査した。 　1つ目が、iOS 8.0以降のiPhone 5s／5cなどで3GからLTEにすぐ切り替わらない現象について。まったくLTEに遷移しなかったり、遷移に約12分もかかったりすることがあるという。このとき、ネットワーク上で何が起こっているのか？　大内氏は、データSIMを利用した場合と、音声／SMS対応SIMを利用した場合とで挙動が異なることを、模式図とやり取りの詳細なデータ（接続シーケンス）を示して説明した。 　まず、前提として端末がモバイルでデータ通信を行うためには、端末がネットワーク上のどこにいるかを示す「位置登録」と、パケット交換器と接続するための「データ通信接続の確立」という2つの手続きが同じネットワーク上で成功することが必要だ。この手続きに、データSIMを使った場合と、音声／SMS対応SIMを使った場合とで差が生じていると大内氏は解説した。 　データSIMの場合の挙動を模式図で見てみよう。3Gネットワークで接続を開始すると、位置登録は成功（写真のStep1、以下同）するのだが、データSIMの場合、データ通信接続の確立時に、LTE端末は強制的にLTEネットワークに遷移（リダイレクション）させられてしまう（Step2）。するとLTEネットワークで位置登録からやり直しとなる（Step3）。LTE経由でデータ通信接続を確立しようとするのだが、古いAPN構成プロファイルを使っていると、なぜかドコモspモードの認証サーバにアクセスしようとし、MVNO（模式図ではIIJ）の認証サーバにアクセスできず、データ通信接続の確立に失敗する。LTEで接続に失敗すると、端末は3Gにフォールバックする（Step4）。 　3Gにフォールバックした際、端末はLTE無線接続能力を無効化し、再度、3Gネットワークで位置登録を行う（STEP5）。今度はLTE無線接続能力が無効化されているので、3Gでデータ通信接続の確立が成功する（STEP6）。端末内では約12分間、LTEの無線接続能力の無効状態が続く。これが解除されると、ハンドオーバーなどさまざまな手順で、最終的には3GからLTEに遷移するのだが、以上のような挙動のせいで、iPhoneが3GからLTEになかなか切り替わらない現象が起こっているというのがIIJの見解だ。 　次に音声／SMS対応SIMの場合を見てみよう。3Gネットワークで接続すると（Step0）、3Gで位置登録を行う（Step1）。次がデータSIMの場合と異なり、端末のLTE無線能力が有効であるにもかかわらず、3Gでデータ通信接続の確立に成功する（Step2）。その後、ハンドオーバーなどの手順で、短時間でLTEに移行する（Step3）。ただし、音声／SMS対応SIMであっても、LTEネットワークで接続を開始する場合は、データSIMでLTE経由で接続しようとする場合と同様に、正しい認証サーバにアクセスしない問題が発生する。 　以上の検証から、3Gでデータ接続を確立できれば、短時間でLTEが利用できることが分かる。そうするためには、機内モードをオン／オフすることが有効だ。端末には、最後につかんだ無線ネットワーク経由で再接続をする特性があり、音声／SMS対応SIMを使っている場合は、3Gをつかんだままのときに機内モードをオン／オフすると3Gでデータ接続確立が行われ、その後すぐにLTEに移行する。しかし、データSIMの場合は、LTE端末だと強制的にLTEネットワークに遷移させられてしまうため、この方法は使えない。 基本情報から価格比較まで――格安SIMの情報はここでチェック！→「SIM LABO」 Copyright© 2017 ITmedia, Inc. All Rights Reserved. この記事が気に入ったらITmedia Mobile に「いいね！」しよう